<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI - Tailwind Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-gray-100 flex flex-col h-screen">

    <header class="p-4 bg-gray-800 border-b border-gray-700 text-center">
        <h1 class="text-xl font-bold text-blue-400">Gemini Stream AI</h1>
    </header>

    <main id="chat-container" class="flex-1 overflow-y-auto p-4 space-y-4 max-w-4xl mx-auto w-full">
        <div class="bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-700 max-w-[80%]">
            Hello! I am Gemini. How can I help you today?
        </div>
    </main>

    <footer class="p-4 bg-gray-800 border-t border-gray-700">
        <div class="max-w-4xl mx-auto flex gap-2">
            <input type="text" id="userInput" 
                class="flex-1 bg-gray-700 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" 
                placeholder="Ask Gemini something...">
            <button id="sendBtn" 
                class="bg-blue-600 hover:bg-blue-500 transition px-6 py-2 rounded-lg font-semibold disabled:opacity-50">
                Send
            </button>
        </div>
    </footer>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');

        async function handleSend() {
            const prompt = userInput.value.trim();
            if (!prompt) return;

            // 1. Add User Bubble
            addMessage(prompt, 'user');
            userInput.value = '';
            
            // 2. Add AI Bubble (Empty placeholder)
            const aiBubble = addMessage('', 'ai');
            sendBtn.disabled = true;

            try {
                const response = await fetch('http://localhost:3000/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value, { stream: true });
                    aiBubble.innerText += chunk;
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }
            } catch (err) {
                aiBubble.innerText = "Error: " + err.message;
            } finally {
                sendBtn.disabled = false;
            }
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            const isUser = sender === 'user';
            
            div.className = isUser 
                ? "bg-blue-700 ml-auto p-4 rounded-lg shadow-sm max-w-[80%] text-white" 
                : "bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-700 max-w-[80%]";
            
            div.innerText = text;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return div;
        }

        sendBtn.addEventListener('click', handleSend);
        userInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') handleSend(); });
    </script>
</body>
</html>
